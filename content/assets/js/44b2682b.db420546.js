"use strict";(self.webpackChunkdocumentation=self.webpackChunkdocumentation||[]).push([[2164],{3905:function(e,t,n){n.d(t,{Zo:function(){return u},kt:function(){return d}});var o=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,o,r=function(e,t){if(null==e)return{};var n,o,r={},a=Object.keys(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=o.createContext({}),p=function(e){var t=o.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},u=function(e){var t=p(e.components);return o.createElement(l.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},m=o.forwardRef((function(e,t){var n=e.components,r=e.mdxType,a=e.originalType,l=e.parentName,u=i(e,["components","mdxType","originalType","parentName"]),m=p(n),d=r,k=m["".concat(l,".").concat(d)]||m[d]||c[d]||a;return n?o.createElement(k,s(s({ref:t},u),{},{components:n})):o.createElement(k,s({ref:t},u))}));function d(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var a=n.length,s=new Array(a);s[0]=m;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i.mdxType="string"==typeof e?e:r,s[1]=i;for(var p=2;p<a;p++)s[p]=n[p];return o.createElement.apply(null,s)}return o.createElement.apply(null,n)}m.displayName="MDXCreateElement"},3378:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return i},contentTitle:function(){return l},metadata:function(){return p},toc:function(){return u},default:function(){return m}});var o=n(7462),r=n(3366),a=(n(7294),n(3905)),s=["components"],i={sidebar_position:3},l="Running Workers Across Services",p={unversionedId:"running-workflows/running-workers-microservices",id:"running-workflows/running-workers-microservices",isDocsHomePage:!1,title:"Running Workers Across Services",description:"So far we have learned some basic aspects of Conductor such as",source:"@site/docs/running-workflows/running-workers-microservices.md",sourceDirName:"running-workflows",slug:"/running-workflows/running-workers-microservices",permalink:"/content/docs/running-workflows/running-workers-microservices",editUrl:"https://github.com/orkes-io/docs/edit/main/docs/running-workflows/running-workers-microservices.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3}},u=[{value:"Prerequisites",id:"prerequisites",children:[]},{value:"Step 1: Creating and Configuring a Workflow",id:"step-1-creating-and-configuring-a-workflow",children:[]},{value:"Step 2: Running the Workflow",id:"step-2-running-the-workflow",children:[]},{value:"Step 3: Adding new Workers",id:"step-3-adding-new-workers",children:[]},{value:"Step 4: Check the results",id:"step-4-check-the-results",children:[]},{value:"Summary",id:"summary",children:[]}],c={toc:u};function m(e){var t=e.components,n=(0,r.Z)(e,s);return(0,a.kt)("wrapper",(0,o.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"running-workers-across-services"},"Running Workers Across Services"),(0,a.kt)("p",null,"So far we have learned some basic aspects of Conductor such as"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"How to run Conductor locally?"),(0,a.kt)("li",{parentName:"ol"},"Using system or built-in tasks such as ",(0,a.kt)("inlineCode",{parentName:"li"},"HTTP")),(0,a.kt)("li",{parentName:"ol"},"Creating and running our first worker task implementation")),(0,a.kt)("p",null,"In this article we will show how to connect multiple different services using a Conductor workflow. This is one of the\nkey features of Conductor. Being able to wire up really complex flows using Conductor will make our life as a developer\nsimple and will help us focus on what matters to our business."),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"Conductor helps to wire up complex flows across different services")),(0,a.kt)("h3",{id:"prerequisites"},"Prerequisites"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"Have a Conductor Server running, with search support using Elasticsearch")),(0,a.kt)("p",null,"We can refer to the guides in this site to get this up and running."),(0,a.kt)("h2",{id:"step-1-creating-and-configuring-a-workflow"},"Step 1: Creating and Configuring a Workflow"),(0,a.kt)("p",null,"So far in our guides, we have created workflows with just one worker. Let's take that up a notch. We will create a\nworkflow that has three steps."),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"Pull some arbitrary sample data from a REST API using an ",(0,a.kt)("inlineCode",{parentName:"li"},"HTTP")," task"),(0,a.kt)("li",{parentName:"ol"},"Write a worker task that consumes this data and augments in with an arbitrary data from local storage"),(0,a.kt)("li",{parentName:"ol"},"Write a second worker task that consumes this updated data from the first worker and creates an output after\nadditional processing")),(0,a.kt)("p",null,"Here is an example workflow - that contains the tasks as described above."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},' {\n  "name": "sample_workflow_with_multiple_workers",\n  "description": "Sample Workflow With Multiple Workers",\n  "version": 1,\n  "tasks": [\n    {\n      "name": "get_population_data",\n      "taskReferenceName": "get_population_data",\n      "inputParameters": {\n        "http_request": {\n          "uri": "https://datausa.io/api/data?drilldowns=State&measures=Population&year=latest",\n          "method": "GET"\n        }\n      },\n      "type": "HTTP"\n    },\n    {\n      "name": "map_state_codes",\n      "taskReferenceName": "map_state_codes",\n      "inputParameters": {\n        "statePopulations": "${get_population_data.output.response.body.data}"\n      },\n      "type": "SIMPLE"\n    },\n    {\n      "name": "compute_median_top_states",\n      "taskReferenceName": "compute_median_top_states",\n      "inputParameters": {\n        "topStateCount": 10,\n        "statePopulations": "${map_state_codes.output.statePopulations}"\n      },\n      "type": "SIMPLE"\n    }\n  ],\n  "outputParameters": {\n    "medianPopulation": "${compute_median_top_states.output.medianPopulation}",\n    "stateCount": "${compute_median_top_states.input.topStateCount}"\n  },\n  "schemaVersion": 2,\n  "restartable": true,\n  "ownerEmail": "example@email.com"\n}\n')),(0,a.kt)("p",null,"First, let's set up the new tasks we are introducing to this workflow. We can use curl to post this. Look at the payload\nto see what we are posting. Basically it is the definition for the two new tasks with mostly default values for every\nfield."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},'curl \'http://localhost:8080/api/metadata/taskdefs\' \\\n  -H \'accept: */*\' \\\n  -H \'Referer: \' \\\n  -H \'Content-Type: application/json\' \\\n  --data-raw \'[{"name":"map_state_codes","retryCount":3,"retryLogic":"FIXED","retryDelaySeconds":10,"timeoutSeconds":300,"timeoutPolicy":"TIME_OUT_WF","responseTimeoutSeconds":180,"ownerEmail":"example@gmail.com"},{"name":"compute_median_top_states","retryCount":3,"retryLogic":"FIXED","retryDelaySeconds":10,"timeoutSeconds":300,"timeoutPolicy":"TIME_OUT_WF","responseTimeoutSeconds":180,"ownerEmail":"example@gmail.com"}]\'\n')),(0,a.kt)("p",null,"Now let's use curl to upload the workflow definition to our conductor server:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},'curl \'http://localhost:8080/api/metadata/workflow\' \\\n  -H \'accept: */*\' \\\n  -H \'Referer: \' \\\n  -H \'Content-Type: application/json\' \\\n  --data-raw \'{"name":"sample_workflow_with_multiple_workers","description":"Sample Workflow With Multiple Workers","version":1,"tasks":[{"name":"get_population_data","taskReferenceName":"get_population_data","inputParameters":{"http_request":{"uri":"https://datausa.io/api/data?drilldowns=State&measures=Population&year=latest","method":"GET"}},"type":"HTTP"},{"name":"map_state_codes","taskReferenceName":"map_state_codes","inputParameters":{"statePopulations":"${get_population_data.output.response.body.data}"},"type":"SIMPLE"},{"name":"compute_median_top_states","taskReferenceName":"compute_median_top_states","inputParameters":{"topStateCount":10,"statePopulations":"${map_state_codes.output.statePopulations}"},"type":"SIMPLE"}],"outputParameters":{"medianPopulation":"${compute_median_top_states.output.medianPopulation}","stateCount":"${compute_median_top_states.input.topStateCount}"},"schemaVersion":2,"restartable":true,"ownerEmail":"example@email.com"}\'\n')),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Some things to note:")),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"We don't have to define our workers in different services, we can have them in the same service",(0,a.kt)("ol",{parentName:"li"},(0,a.kt)("li",{parentName:"ol"},"This is helpful when we want to create modular simple workers that we can use to assemble complex flows"))),(0,a.kt)("li",{parentName:"ol"},"We can define our workers in any language - in our article we have chosen ",(0,a.kt)("inlineCode",{parentName:"li"},"Java")," to demonstrate the functionality",(0,a.kt)("ol",{parentName:"li"},(0,a.kt)("li",{parentName:"ol"},"This ",(0,a.kt)("strong",{parentName:"li"},"language agnostic workers")," for our workflow is another important feature of Conductor. We no longer have\nto work within the constraints of a single language."))),(0,a.kt)("li",{parentName:"ol"},"Conductor provides system tasks that can do quite a bit of the common transformations which means we don't have to\nmanually implement the workers for some tasks used in this example. For the purpose of demo, we are implementing"),(0,a.kt)("li",{parentName:"ol"},"In this demo, we are also learning how to read data from one worker and use it in another worker. This is what makes\nit all possible. There are advanced options on how to use this, and we can find that in our guides ")),(0,a.kt)("h2",{id:"step-2-running-the-workflow"},"Step 2: Running the Workflow"),(0,a.kt)("p",null,"It's time to kick off a workflow. We can use the following curl command to run this. There are no input params required,\nso its left as empty."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"curl 'http://localhost:8080/api/workflow/sample_workflow_with_multiple_workers' \\\n  -H 'accept: text/plain' \\\n  -H 'Referer: ' \\\n  -H 'Content-Type: application/json' \\\n  --data-raw '{}' \n")),(0,a.kt)("p",null,"Once we run this and check the status on the UI, we will notice that the first worker has completed its part and now the\nworkflow is waiting for a worker to pick up the next task. We haven't added our workers yet. And that doesn't impact the\nworkflow run. It will wait until its timeout settings before error-ing out."),(0,a.kt)("h2",{id:"step-3-adding-new-workers"},"Step 3: Adding new Workers"),(0,a.kt)("p",null,"Now let's go ahead and add the workers across two different services. We will implement the ",(0,a.kt)("inlineCode",{parentName:"p"},"map_state_codes")," worker in\nour previously created ",(0,a.kt)("inlineCode",{parentName:"p"},"Java")," application. Here is the code for this."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript",metastring:"reference",reference:!0},"https://github.com/orkes-io/orkesworkers/blob/main/src/main/java/io/orkes/samples/workers/MapStateCodeWorker.java#L1-L39\n")),(0,a.kt)("p",null,"As this is part of the sample application that we wrote before, the worker will be auto added to the list of workers the\napplication manages based on the Spring Boot settings shown here."),(0,a.kt)("p",null,"Notice how all the workers are auto injected via ",(0,a.kt)("inlineCode",{parentName:"p"},"List<Worker> workersList"),". Spring Boot will discover all the implementations of the ",(0,a.kt)("inlineCode",{parentName:"p"},"Worker")," interface and will inject an instance of that into\nthis method."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js",metastring:"reference",reference:!0},"https://github.com/orkes-io/orkesworkers/blob/main/src/main/java/io/orkes/samples/OrkesWorkersApplication.java#L31-L43\n")),(0,a.kt)("h2",{id:"step-4-check-the-results"},"Step 4: Check the results"),(0,a.kt)("h2",{id:"summary"},"Summary"),(0,a.kt)("p",null,"In this post \u2014 we learned how to run a sample workflow in our Conductor installation with a custom worker. Concepts we\ntouched on:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"Adding Workflow definition with multiple ",(0,a.kt)("inlineCode",{parentName:"li"},"SIMPLE")," tasks"),(0,a.kt)("li",{parentName:"ol"},"Passing inputs to tasks"),(0,a.kt)("li",{parentName:"ol"},"Using outputs of previous tasks for next tasks"),(0,a.kt)("li",{parentName:"ol"},"Running your workers across multiple services")),(0,a.kt)("p",null,"Thank you for reading, and we hope you found this helpful. Please feel free to reach out to us for any questions and we\nare happy to help in any way we can."))}m.isMDXComponent=!0}}]);